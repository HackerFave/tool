;**********************************************************************
;名称：个人化参考设计脚本
;版本：V00
;作者：liyi
;日期：2021.4.9
;用途：SE个人化
;**********************************************************************

;SEID，根据实际修改SEID值，不能为空
SE_ID="11223344556677889900112233445566"

;3DES密钥
3DES128_KEY="00000000000000000000000000000000"

;AES密钥
AES128_KEY="00000000000000000000000000000000"

;SM4密钥
SM4_KEY="00000000000000000000000000000000"

;ECC密钥
ECC256_pub="D17ED15EDFFFFBC6DB023E1F4E4B9A45C590A816F8CAE301633940E483791728C85E5C328BC059F7A30496B846B5932E7E3E1D34AB53B3CBFF1D98954EFDF511"
ECC256_pri="160B55FF3B18EEAEF8F0789B5B0912269EBDE19D41079D87B27522F345723EA9"

;RSA密钥
RSA1024_pub="CE0BA793E1271566F863C81CC2276BE17B3A581CBDE097536BD37EF6C61E30C36D4E0808E47243B9997D6FAEA664B00EEF7873F5F247263E835F1C9DB9EFA9AFFCDE658B3F72966B056D27A09C2F41D8B02A3A5697D2B40BEDA4C8BA750A80FD68521DB1ED441B94DB2A5B4E1BBCD44C64D6D2917B423AA91F0C146788D69055"
RSA1024_P="FEE8AC71C6526090A9835EA1C0A4DDA6BC7157A77F9B9D614472C665A9CEC2C257A9D775C2BDA170DE62B9EA6278C3B8A9C9D641DB4A895384747576A9608DD1"
RSA1024_Q="CEED6FE2C2E3454CD9A984784E4C64B68DAEB7E8E0A6A34EE2B86563A7E1C894E7D5889FCBBA49D5A35367CE735A70C4467DEEA5DBD3D2BA61D1E68492BDA745"
RSA1024_DP="BE6C96960FEF6E0FE3722DF96BEE3D5ED79B5C3DD6882B93840CB1C5348B2ED6FBA1F741138F91D0BD70C72E1F0DD438592E5C8EAA010E81838B744C86CF8861"
RSA1024_DQ="56FC9D5238170E24D6435ABAB03F90FEE4E493CF43D10949BA294605F4A70789014454A0C825D1B00B6E9E6EBD3341C060D9C39ED9A05C2F99BB812A2DFDA7F9"
RSA1024_INVQ="456FE77BBD2493BAD9D767C9B36A303AD30CED3703095A909FA0FBBA3FC1B0B6046F05E551D8598F1C690D678D743B985E7029CD6D0E1A3975C7314829C2ED68"
RSA2048_pub="B25AE3DFDDF5C244817320AAC543D8DF6546E41ECFFC641EE22B4738315428A1F2E5FAE7EAF419FE36DF948F0AFD042D675E750C1FF712CD80DE7C5861C8D1594A561B0741716824222631F694E318A0400E9ACE270838B3A1EE067C9147C6CD14C8F0419FB12742EB0DE25B7D2F59A7270C31EA04BC9CF93CD6D4B8511A8913DA9BF951F0E29915B53C395658E9BA74A3B529D6C884171E3ADCE5C25C56678C5512C3171C08939CDDDCB71B4382CDC9C32295C4133B236AD1E5DC4E41C6B90CB52C8AC6AD3019E5F0CF867C67C96F1955CAF07921984BAA6EC97B669526CD4D1974D7A20263E5442E770DA9825AB5232E0053895F6DB82DAA5E417ECE67F959"
RSA2048_P="ED4F60E9BEC7D190988E92BC8248434EC3AFE678C568E57F4C4D6289BC53B9648990E3D2C3B34C4A47997B619E7054CBCB6DC6EF777D6946E0A0D2528D99A5B4815796CC574268838DC98979CE52D478B05D567DB587905E54708C697DACDED1DAD959D2C56AE3AD69ECA6D3577367C25A5549577E527545B5D894B755B3D46F"
RSA2048_Q="C066DDC078545BB1567FB5C492974F4C78B07488BB7572D391BA5E834191B4B28DE0945470A095C7645AC3E14DC4836FA89A4BAA7766CC9B4C57E67F71C6C3BFAAC57DDF82A5D4996BD9D8C66DC3E26A759BA38C5191A5E2904BBDE3988CD1AA71768EAE5FB0CA4E8C71CD9D539AD7D3BB6667B6C0C862809956806E9F91C2B7"
RSA2048_DP="522AFDFF715376B87E5A3F6C8E1FBF4E726B617DC7BCBE5A096D720506F46668ED4901D964719CA4CB8DD52EC3D1594B07310784BAF6ED90E10E4E44CF4AB8197BFF7BF35CF35D84CF7F4CDEA416020397ED79992555BF232A519E0C98BB569B8B0F5F0E9FD496E8E098545B31188080C70E68CAA6AE9E7478B67927D1C0E679"
RSA2048_DQ="B83785A8CC4D910189DD7B8F3C002E07FD228E61808322AF59BF84D0CDCE11A2485FB805E5548C343E6CFD51D2A10E6BB196124EA446442F89783C14D83E449C5689034D270D5A328F6624BD50C99616F28653A07D5523EC7AD65A78F94E134DCB97856385F182B2949C3E0F9DC60B520A0331D8745B289D12B41502563C3C9F"
RSA2048_INVQ="48D0E05C4F49E480C09BDF0AEB712DE24556F2ECA76F1FEA2E33DBAAE63AEFD4E5479C31212F6648A63A81821F13C5F5C88F68FCC37B8D4653EFD8A3F2109DE6EBFBEA00CB29557A64C6730CB47FF0CEBBE6738EBB5FD455EE159E4BA41583AF981CAE7BF2A72F36794D705587155D85E75E8D5013A2A2A08316999880CE2A92"

;SM2密钥
SM2_pub="160E12897DF4EDB61DD812FEB96748FBD3CCF4FFE26AA6F6DB9540AF49C942324A7DAD08BB9A459531694BEB20AA489D6649975E1BFCF8C4741B78B4B223007F"
SM2_pri="81EB26E941BB5AF16DF116495F90695272AE2CD63D6C4AE1678418BE48230029"

;文件数据
TEST_DATA1="000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
TEST_DATA2="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

;管理密钥
MKEY="404142434445464748494A4B4C4D4E4F"
TPK="404142434445464748494A4B4C4D4E4F"
APIN="123456789ABCDEF0123456789ABCDEF0"
UPIN="112233445566"
KEY="303132333435363738393A3B3C3D3E3F"
PIN="1122334455667788"


RESET_CARD()


;###################################################################################################
;###认证设备主控密钥
;###################################################################################################
APDU=0084000010
CALFUN:HD_SM4_EN(RESP,MKEY,enc)
APDU=0082000010 (enc)


;###################################################################################################
;###清空MF
;###################################################################################################
APDU=80CE000000
APDU=80EE000000


;###################################################################################################
;###个人化
;###################################################################################################
;建立DDF1
;DDF1(文件标识符)|81(管理员创建/删除，默选DDF)|80(管理员写密钥)|02(写密钥标识)|00(文件名长度)
APDU=80E0000106 DDF1 81 80 02 00

;###################################################################################################
;###明文装载管理员PIN
;###################################################################################################
;拼接数据：00(PIN)|00(管理员PIN标识符)|00000000(RFU)|0010(长度)APIN(管理员PIN)
APDU=80D400FF18 00 00 00000000 0010 (APIN)

;验证管理员PIN
APDU=0084000010
CAT(data,RESP,APIN)
CALFUN:HD_SM3_COMPRESS(data,hash,"256")
LEFT(hash,hash,"32")
APDU=0020000010 (hash)

;###################################################################################################
;###明文装载传输密钥
;###################################################################################################
;拼接数据：01(传输密钥)|02(传输密钥标识符)|40(SM4)|000000(RFU)|0010(密钥长度)|TPK(传输密钥)
APDU=80D400FF18 01 02 40 000000 0010 (TPK)


;###################################################################################################
;###明文装载用户PIN
;###################################################################################################
;拼接数据：00(PIN)|01(用户PIN)|0F(Limit)|000000(RFU)|0006(PIN长度)|UPIN(用户PIN)
APDU=80D400FF0E 00 01 0F 000000 0006 (UPIN)


;建立二进制文件，自由读写
;0005(文件标识符)|0400(文件大小)|00(自由读)|00(自由写)|02(读密钥标识)|02(写密钥标识)|00(文件名长度)
APDU=80E0000309 0005 0400 00 00 02 02 00

;建立二进制文件，自由读，受控写
;0006(文件标识符)|0400(文件大小)|00(自由读)|80(管理员写)|02(读密钥标识)|02(写密钥标识)|00(文件名长度)
APDU=80E0000309 0006 0400 00 80 02 02 00

;建立二进制文件，受控读，受控写
;0007(文件标识符)|0400(文件大小)|80(管理员读)|80(管理员写)|02(读密钥标识)|02(写密钥标识)|00(文件名长度)
APDU=80E0000309 0007 0400 80 80 02 02 00

;建立SE证书文件，自由读，受控写
;0008(文件标识符)|0800(文件大小)|00(自由读)|40(用户写)|02(读密钥标识)|02(写密钥标识)|00(文件名长度)
APDU=80E0000309 0008 0800 00 40 02 02 00

;建立CA证书文件，自由读，受控写
;0009(文件标识符)|0800(文件大小)|00(自由读)|40(用户写)|02(读密钥标识)|02(写密钥标识)|00(文件名长度)
APDU=80E0000309 0009 0800 00 40 02 02 00

;写入SEID
LENGTH(L,"H",SE_ID)
APDU=80D20000(L) (SE_ID)


;###################################################################################################
;###明文装载SM4对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|06(应用密钥标识符)|40(SM4算法)|000000(RFU)|0010(密钥长度)|SM4_KEY(SM4密钥)
APDU=803C000018 02 06 40 000000 0010 (SM4_KEY)


;###################################################################################################
;###使用传输密钥密文装载3DES128对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|03(应用密钥标识符)|00(3DES128算法)|000000(RFU)|0010(密钥长度)|3DES128_KEY(3DES128密钥)
CAT(data,"0010",3DES128_KEY,"8000000000000000000000000000")
CALFUN:HD_SM4_EN(data,TPK,enc)
APDU=803C340228 02 03 00 000000 0010 (enc)


;###################################################################################################
;###使用SM4对称应用密钥密文装载AES128对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|04(应用密钥标识符)|60(AES128算法)|000000(RFU)|0010(密钥长度)|AES128_KEY(AES128密钥)
CAT(data,"0010",AES128_KEY,"8000000000000000000000000000")
CALFUN:HD_SM4_EN(data,SM4_KEY,enc)
APDU=803C140628 02 04 60 000000 0010 (enc)


;###################################################################################################
;###明文装载ECC256非对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|09(应用密钥标识符)|A0(ECC256公钥)|20(ECC256模长)|0000(RFU)|0040(密钥长度)|ECC256_pub(ECC256公钥)
APDU=803C000048 02 09 A0 20 0000 0040 (ECC256_pub)
;拼接数据：02(应用密钥)|0A(应用密钥标识符)|A1(ECC256私钥)|20(ECC256模长)|00(自由使用)|00(RFU)|0020(密钥长度)|ECC256_pri(ECC256私钥)
APDU=803C000028 02 0A A1 20 00 00 0020 (ECC256_pri)


;###################################################################################################
;###使用传输密钥密文装载RSA1024非对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|0B(应用密钥标识符)|80(RSA公钥)|20(RSA1024模长)|0000(RFU)|0084(密钥长度)|00010001(RSA公钥E)|RSA1024_pub(RSA1024公钥N)
CAT(data,"0084","00010001",RSA1024_pub,"80000000000000000000")
CALFUN:HD_SM4_EN(data,TPK,enc)
APDU=803C340298 02 0B 80 20 0000 0084 (enc)
;拼接数据：02(应用密钥)|0C(应用密钥标识符)|82(RSA_CRT私钥)|20(RSA1024模长)|00(自由使用)|00(RFU)|0140(密钥长度)|RSA1024_P(RSA1024私钥P)|RSA1024_Q(RSA1024私钥Q)|RSA1024_DP(RSA1024私钥DP)|RSA1024_DQ(RSA1024私钥DQ)|RSA1024_INVQ(RSA1024私钥INVQ)
CAT(data,"0144","00010001",RSA1024_P,RSA1024_Q,RSA1024_DP,RSA1024_DQ,RSA1024_INVQ,"80000000000000000000")
CALFUN:HD_SM4_EN(data,TPK,enc)
APDU=803C3402000158 02 0C 82 20 00 00 0144 (enc)


;###################################################################################################
;###明文装载RSA2048非对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|0D(应用密钥标识符)|84(RSA_CRT密钥对)|40(RSA2048模长)|00(自由使用)|00(RFU)|0384(密钥长度)|00010001(RSA公钥E)|RSA2048_pub(RSA2048公钥N)|RSA2048_P(RSA2048私钥P)|RSA2048_Q(RSA2048私钥Q)|RSA2048_DP(RSA2048私钥DP)|RSA2048_DQ(RSA2048私钥DQ)|RSA2048_INVQ(RSA2048私钥INVQ)
APDU=803C000000038C 02 0D 84 40 00 00 0384 00010001 (RSA2048_pub)(RSA2048_P)(RSA2048_Q)(RSA2048_DP)(RSA2048_DQ)(RSA2048_INVQ)


;###################################################################################################
;###使用SM4对称应用密钥密文装载SM2非对称算法密钥
;###################################################################################################
;拼接数据：02(应用密钥)|0F(应用密钥标识符)|92(SM2密钥对)|20(SM2模长)|00(自由使用)|00(RFU)|0060(密钥长度)|SM2_pub(SM2公钥)|SM2_pri(SM2私钥)
CAT(data,"0060",SM2_pub,SM2_pri,"8000000000000000000000000000")
CALFUN:HD_SM4_EN(data,SM4_KEY,enc)
APDU=803C140678 02 0F 92 20 00 00 0060 (enc)


;========================end=======================
