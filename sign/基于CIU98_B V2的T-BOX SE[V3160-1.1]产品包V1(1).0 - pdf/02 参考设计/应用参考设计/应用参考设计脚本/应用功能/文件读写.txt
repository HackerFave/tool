;**********************************************************************
;名称：文件读写
;版本：V00
;作者：liyi
;日期：2021.4.9
;用途：文件读写权限和内容读写
;**********************************************************************

;管理密钥
MKEY="404142434445464748494A4B4C4D4E4F"
TPK="404142434445464748494A4B4C4D4E4F"
APIN="123456789ABCDEF0123456789ABCDEF0"
UPIN="112233445566"
TEST_DATA1="111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
TEST_DATA2="1111111111111111111111111111111111111111111111"
TEST_DATA3="000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"


RESET_CARD()


;###################################################################################################
;###验证管理员PIN
;###################################################################################################
APDU=0084000010
CAT(data,RESP,APIN)
CALFUN:HD_SM3_COMPRESS(data,hash,"256")
LEFT(hash,hash,"32")
APDU=0020000010 (hash)


;###################################################################################################
;###验证用户PIN
;###################################################################################################
APDU=0084000010
CAT(data,RESP,UPIN)
CALFUN:HD_SM3_COMPRESS(data,hash,"256")
LEFT(hash,hash,"32")
APDU=0020000110 (hash)


;###################################################################################################
;###读写0005文件
;###################################################################################################
;选择0005文件
APDU=00A4000002 0005

;读取0005文件内容，无权限，密文读
APDU=04B0000000

;更新0005文件内容，无权限，无保护
APDU=00D60000FF (TEST_DATA1)

;读取更新后的内容
APDU=00B00000FF
IsEqual(RESP,TEST_DATA1)

;重新更新为00
APDU=00D60000FF (TEST_DATA3)


;###################################################################################################
;###读写0006文件
;###################################################################################################
;选择0006文件
APDU=00A4000002 0006

;读取0006文件内容，无权限，无保护
APDU=00B00000FF

;更新0006文件内容，管理员写，密文写
CAT(data,"00FF",TEST_DATA1,"800000000000000000000000000000")
CALFUN:HD_SM4_EN(data,TPK,enc)
APDU=04D60000000110 (enc)

;读取更新后的内容
APDU=00B00000FF
IsEqual(RESP,TEST_DATA1)

;重新更新为00
APDU=00D60000FF (TEST_DATA3)


;###################################################################################################
;###读写0007文件
;###################################################################################################
;选择0007文件
APDU=00A4000002 0007

;读取0007文件内容，管理员读，无保护
APDU=00B00000FF

;更新0007文件内容，管理员写，无保护
APDU=00D60000FF (TEST_DATA1)

;读取更新后的内容
APDU=00B00000FF
IsEqual(RESP,TEST_DATA1)

;重新更新为00
APDU=00D60000FF (TEST_DATA3)


;###################################################################################################
;###读写0008文件
;###################################################################################################
;选择0008文件
APDU=00A4000002 0008

;读取0008文件内容，无权限，无保护
APDU=00B00000FF

;更新0008文件内容，用户写，无保护
APDU=00D60000FF (TEST_DATA1)

;读取更新后的内容
APDU=00B00000FF
IsEqual(RESP,TEST_DATA1)

;重新更新为00
APDU=00D60000FF (TEST_DATA3)


;###################################################################################################
;###读写0009文件
;###################################################################################################
;选择0009文件
APDU=00A4000002 0009

;读取0009文件内容，无权限，无保护
APDU=00B00000FF

;更新0009文件内容，用户写，无保护
APDU=00D60000FF (TEST_DATA1)

;读取更新后的内容
APDU=00B00000FF
IsEqual(RESP,TEST_DATA1)

;重新更新为00
APDU=00D60000FF (TEST_DATA3)


;========================end=======================
